services:
  # Servicio de PostgreSQL
  db:
    image: postgres:14-alpine
    container_name: mi-proyecto-db
    restart: always
    environment:
      POSTGRES_USER: user_db
      POSTGRES_PASSWORD: password_db
      POSTGRES_DB: auth_db
    ports:
      # Mapea el puerto de la base de datos para poder conectarte desde tu máquina si es necesario
      - "5432:5432"
    volumes:
      # Persiste los datos de la base de datos
      - postgres_data:/var/lib/postgresql/data
    networks:
      - mi-red

  # Servicio del Backend
  backend:
    build: ./backend
    container_name: mi-proyecto-backend
    restart: always
    ports:
      - "3000:3000" # Mapea el puerto 3000 del host al 3000 del contenedor
    depends_on:
      - db # El backend no se iniciará hasta que la base de datos esté lista
    environment:
      - NODE_ENV=production
      # Variables de entorno para la conexión a la base de datos
      - PGHOST=db
      - PGPORT=5432
      - PGUSER=user_db
      - PGPASSWORD=password_db
      - PGDATABASE=auth_db
      # Variable de entorno para el secreto del JWT
      - JWT_SECRET=este-es-un-secreto-mucho-mas-seguro-y-largo
      # Variables de entorno para el envío de correos (Nodemailer)
      - EMAIL_HOST=smtp.ethereal.email
      - EMAIL_PORT=587
      - EMAIL_USER=your_ethereal_email@ethereal.email # Reemplaza con tu email de Ethereal
      - EMAIL_PASSWORD=your_ethereal_password # Reemplaza con tu contraseña de Ethereal
      - EMAIL_FROM="Mi Aplicación" <no-reply@example.com>
    networks:
      - mi-red

  # Servicio del Frontend
  frontend:
    build: ./frontend
    container_name: mi-proyecto-frontend
    restart: always
    ports:
      - "80:80" # Mapea el puerto 80 del host al 80 del contenedor (Nginx)
    depends_on:
      - backend # Indica que el frontend depende del backend
    networks:
      - mi-red

volumes:
  postgres_data:

networks:
  mi-red:
    driver: bridge
